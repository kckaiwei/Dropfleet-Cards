<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dropfleet Commander Command Cards</title>
<style>
    #hand {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin-bottom: 20px;
    }
    .card {
        width: 100px;
        height: 150px;
        background-color: lightgray;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 20px;
    }
</style>
</head>

<script>

        // Initialize Cards
        let scourgeFilename = "/Dropfleet-Cards/Scourge_Command_Cards_Print_At_Home/Scourge_Command_Cards_Print_At_Home-";
        let phrFilename = "/Dropfleet-Cards/PHR_Command_Cards/PHR_Command_Cards-";
        let scourgeArray = [];
        let phrArray = [];
        for (let i = 1; i <= 57; i++) {
            const sfilename = scourgeFilename + (i < 10 ? '0' + i : i) + ".jpg";
            const pfilename = phrFilename + (i < 10 ? '0' + i : i) + ".jpg";
            scourgeArray.push(sfilename);
            phrArray.push(pfilename);
        }

        let cards = scourgeArray;
        let selection = "Scourge";
        let hand = [];
    
        // Define an array of cards

        function setCookie(selection, hand, deck) {
            let cookie = "selection" + "=" + encodeURIComponent(selection);
            cookie += "; deck=" + JSON.stringify(deck);
            cookie += "; hand=" + JSON.stringify(hand);

            let expirationDate = new Date();
            expirationDate.setDate(expirationDate.getDate() + 30);
            cookie += "; expires=" + expirateionDate.toUTCString();

            document.cookie = cookie
        }

        // Read cookies
        let cookiesDict = {};
        document.cookie.split(";").forEach(cookie => {
            let parts = cookies.split("=")
            let key = parts[0].trim();
            let value = decodeURIComponent(parts.slice(1).join('='));
            cookiesDict[key] = value;
        })

        if (cookiesDict.hasOwnProperty("selection")) {
            selection = cookiesDict["selection"]
        }
        if (cookiesDict.hasOwnProperty("hand")) {
            hand = cookiesDict["hand"]
        }
        if (cookiesDict.hasOwnProperty("deck")) {
            cards = cookiesDict["deck"]
        }

        const selectElement = document.createElement("select");

        const options = ['Scourge', 'PHR'];
    options.forEach(optionText => {
        const option = document.createElement('option');
        option.textContent = optionText;
        selectElement.appendChild(option);
    });

        selectElement.value = selection;

        function changeFaction() {
            const selectedOption = event.target.value;
            console.log('Selected option:', selectedOption);
            if (selectedOption == "Scourge") {
                cards = scourgeArray;
                selection = "Scourge";
            } else if (selectedOption == "PHR") {
                cards = phrArray;
                selection = "PHR";
            }
            console.log(cards)
        };

        // Function to draw a random card and add it to the hand
        function drawCard() {
            const randomIndex = Math.floor(Math.random() * cards.length);
            const card = cards[randomIndex];
            hand.push(card);
            cards.pop(card);
            console.log(hand)
            displayHand();
            setCookie(selection, hand, cards);
        }

        // Function to display the hand
        function displayHand() {
            const handElement = document.getElementById('hand');
            let count = 0;
            handElement.innerHTML = '';
            hand.forEach(card => {
                const cardElement = document.createElement('div');
                let img = document.createElement("img");
                let discardButton = document.createElement('button');
                discardButton.textContent = "Discard";
                discardButton.addEventListener('click', function() {
                    discardCard(card);
                });
                img.src = card
                cardElement.appendChild(img)
                cardElement.appendChild(discardButton);
                handElement.appendChild(cardElement);
            });
        }

        // Function to discard a card from the hand
        function discardCard(cardName) {
            if (hand.length === 0) {
                alert("Hand is empty!");
                return;
            }
            hand = hand.filter(item => item !== cardName);
            displayHand();
            setCookie(selection, hand, cards);
        }
</script>
    
<body>
    <h1>Card Game</h1>
    <select id="faction-select" onchange="changeFaction()">
         <option value="Scourge">Scourge</option>
        <option value="PHR">PHR</option>
    </select>
    <button onclick="drawCard()">Draw Card</button>
    <div id="hand"></div>


</body>
</html>
